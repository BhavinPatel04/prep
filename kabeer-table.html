<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Table</title>
    <!-- Call me if you have any questions -->
    <style>
      body {
        margin: 0;
        color: #333;
        display: flex;
        justify-content: center;
        margin-top: 1%;
      }

      table {
        width: 97%;
        border-collapse: collapse;
      }

      table,
      th,
      td {
        border: 1px solid #ccc;
      }

      th {
        background: #eee;
      }

      th,
      td {
        padding: 10px;
      }

    </style>
    <!-- Above classes are styling only the table. If you need to style table, only then copy above classes -->
    <!-- Only below classes are required for this to work -->
    <style>
      .collapsed {
        display: none;
      }

      .expand-icon {
        cursor: pointer;
        font-weight: bold;
        font-size: 18px;
        color: blue;
        margin-right: 8px;
      }

      .add-icon::before {
        content: '+';
      }

      .subtract-icon::before {
        content: '-';
      }

    </style>
  </head>

  <body>
    <!-- HTML for table -- start -->
    <table>
      <thead></thead>
      <tbody></tbody>
    </table>
    <!-- HTML for table -- end -->
    <script>
      /**
       * - Just add the columns here
       * - Note that the `key` should be EXACTLY SAME as the property in data
       * - This script is actually generating the table HTML
       * - You can also use this script to generate table HTML and then copy/paste 
       *    the table anywhere you like
       */
      const columns = [
        {
          label: "Name",
          key: "name"
        }, {
          label: "Description",
          key: "description"
        }, {
          label: "Type",
          key: "type"
        }
      ];

      /**
       * Change the data for the table here
       */
      const data = [
        {
          name: "someName",
          description: "some description",
          type: "String", // childpointer: row-0
          children: [
            {
              name: "someName lvl 1.1",
              description: "some description",
              type: "String", // row-0;  childpointer: row-0-child-0
              children: [
                {
                  name: "someName lvl 2.1",
                  description: "some description",
                  type: "String", // row-0-child-0
                }, {
                  name: "someName lvl 2.2",
                  description: "some description",
                  type: "String", // row-0-child-0
                }
              ]
            }, {
              name: "someName lvl 1.2",
              description: "some description",
              type: "String", // row-0;  childpointer: row-0-child-1
            }
          ]
        }, {
          name: "someOtherName",
          description: "some description",
          type: "String",
          children: [
            {
              name: "someOtherName lvl 1",
              description: "some description",
              type: "String",
            }
          ]
        }, {
          name: "someOtherNameAgain",
          description: "some description",
          type: "String",
        }
      ];

      /**
       * This creates the header
       */
      const thead = document.querySelector('thead');
      const headers = generateHeaders(columns);
      thead.innerHTML = headers;

      function generateHeaders(cols) {
        let data = '<tr>';

        cols.forEach(column => {
          data += `<th>${column.label}</th>`;
        });

        data += '</tr>';

        return data;
      };

      /**
       * This creates the body
       */
      const tbody = document.querySelector('tbody');
      const rows = generateRow(columns, data, {});
      tbody.innerHTML = rows;

      function generateRow(cols, rows, options) {
        let data = '';

        // defaulting the level to 0
        if (!options.level) {
          options.level = 0;
        }

        rows.forEach((row, index) => {
          // creating correct childPointer class
          if (options.childPointer) { // row-0
            options.childPointer += `-child-${options.level - 1}`; // row-0-child-0-child-0
          } else {
            options.childPointer = `row-${index}`
          };

          // creating proper classes
          const classList = `level-${options.level} 
            ${options.level > 0 ? `collapsed ${options.childClass || ""}` : ""}`;

          // creating the attribute childPointer which gives correct child className
          const childPointerAttr = row.children ? `childpointer="${options.childPointer}"` : "";

          // starting row
          data += `<tr class="${classList}" ${childPointerAttr}>`;

          // creates the columns with data in row
          cols.forEach((column, colIndex) => {
            /**
             * row = {
                  name: "someOtherNameAgain",
                  description: "some description",
                  type: "String",
                }
            */
            /**
             * column = { label: "Name", key: "name" }
             */
            // row[column.key] ==> row["name"] ==> someOtherNameAgain
            // colIndex === 0 adds + sign on 1st column, colIndex === 1 will add + sign on 2nd column and so on
            // to change the icon style, check the .expand-icon in <style> above
            const addIcon = row.children && colIndex === 0 ? `<span class="expand-icon add-icon"></span>` : "";
            const style = options.level && colIndex === 0 ? `style="padding-left: ${options.level * 25}px;"` : "";
            data += `<td ${style}>${addIcon}${row[column.key]}</td>`;
            // Note: We can add anything you want here. ANYTHING: input box / dropdown / anything
          });

          // finishing row
          data += `</tr>`;

          // will create child rows
          if (row.children) {
            const _options = {
              ...options,
              level: options.level + 1, // 1 + 1
              childClass: options.childPointer // row-0-child-0
            };

            data += generateRow(cols, row.children, _options);
          };
        });

        return data;
      };
    </script>
    <script>
      /**
       * - Script is very important
       * - Note the classNames (`expand-icon`, `add-icon`, `subtract-icon`, `collapsed`)
       *    are same that we used before
       * - Below script is the essence of this file
       * - You can just copy the html (after table is generated), above style 
       *    and this below script and it will still work
       */
      // getting all the expand-icon elements
      const expandIcons = document.getElementsByClassName("expand-icon");
      for (let i = 0; i < expandIcons.length; i++) {
        (function () {
          const icon = expandIcons[i];
          // binding click event to all the expand-icons
          icon.addEventListener("click", function ($event) {
            let tr = $event.target;
            // get the tr element
            while (tr && tr.nodeName != 'TR') {
              tr = tr.parentNode;
            };
            if (!tr) {
              return;
            };

            // toggle + & - icons

            // showing / hiding children
            // const childPointer = tr.getAttribute("childpointer"); // row-0
            // const children = document.getElementsByClassName(childPointer); // row-0
            // for (let c = 0; c < children.length; c++) {
            //   const child = children[c];
            //   const cp = child.getAttribute("childpointer");
            //   if(cp) {
            //     const children = document.getElementsByClassName(childPointer); // row-0

            //   }
            //   child.classList.toggle('collapsed');
            // };
            toggleCollapsed(tr);
          });
        }());
      };

      function toggleCollapsed(element) {
        const iconEl = element.getElementsByClassName("add-icon")[0];
        if (iconEl) {
          iconEl.classList.toggle('subtract-icon');
        }
        const childPointer = element.getAttribute("childpointer"); // row-0
        if (!childPointer) {
          return;
        }
        const children = document.getElementsByClassName(childPointer); // row-0
        for (let c = 0; c < children.length; c++) {
          const child = children[c];
          if (!child.classList.contains('collapsed')) {
            toggleCollapsed(child);
          }
          child.classList.toggle('collapsed');
        };
      }
    </script>
  </body>

</html>
